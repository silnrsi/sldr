name: Flatten SLDR and publish master to staging
on:
  push:
    paths:
    - .github/workflows/**
    - sldr/**
    branches: [ master, feat/*, fix/* ]

jobs:
  build:
    uses: ./.github/workflows/build.yml

  # Deploy built artefacts to the secrets.UPLOAD_TARGET
  deploy:
    needs: build
    # Don't deploy changes from feat and fix branches
    if: github.ref_name == 'master'
    uses: ./.github/workflows/deploy.yml
    secrets: inherit
    with:
      stage-to: sldr-staging
